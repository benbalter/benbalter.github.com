<!DOCTYPE html>
<html lang="{{ site.lang }}" xml:lang="{{ site.lang }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link type="text/plain" rel="author" href="{{ "humans.txt" | absolute_url }}" />
    <link rel="shortcut icon" href="{{ "/favicon.ico?v=" | append: site.github.build_revision | relative_url }}">
    <link href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}" rel="stylesheet" media="screen">
    <!-- SEARCH START -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/search.css">
    <!-- SEARCH END -->

    {% feed_meta %}
    {% seo %}

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', '{{ site.ga_username }}', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body class="{{ page.layout }} post{{ page.id | slugify | prepend: "-"}}">
    <div class="container">

      {% if layout.hero %}
        <div class="hero-unit">&nbsp;</div>
      {% endif %}

      {% include nav.html %}

      <div class="content" id="content" role="main">
        {{ content }}
      </div><!-- /.content -->

      <div class="row">
      	{% if page.hero %}
      	  <div class="col-sm-12 footer">
      	{% else %}
      	  <div class="col-sm-10 col-sm-offset-1 footer">
      	{% endif %}
      		<div class="fine-print">
            <ul>
              {% for path in site.footer_pages %}
                {% assign footer_page=site.pages | where:"path",path | first %}
                <li>
                  <a href="{{ footer_page.url | relative_url }}">{{ footer_page.title }}</a>
                </li>
              {% endfor %}
              <li>
                <a href="{{ "/feed.xml" | relative_url }}" aria-label="Atom Feed"><i class="fa fa-rss"></i></a>
              </li>
            </ul>
      		</div>
      	</div>
      </div>
    </div><!--/.container-->

    <script src="{{ "/assets/js/bundle.js?=" | append: site.github.build_revision | relative_url }}"></script>
    <script src="https://platform.twitter.com/oct.js" type="text/javascript"></script>
    <script type="text/javascript">twttr.conversion.trackPid('{{ site.twitter.property_id }}', { tw_sale_amount: 0, tw_order_quantity: 0 });</script>
    <!-- SEARCH START -->
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0"></script>
    <script>
      var searchHits = document.getElementById('search-hits');
      var staticContent = document.querySelectorAll('.posts')[0];

      var search = instantsearch({
        appId: '{{ site.algolia.application_id }}',
        indexName: '{{ site.algolia.index_name }}',
        apiKey: 'ff7b0847d8705c279222272303e68527',
        searchParameters: {
          hitsPerPage: 15
        },
        // Hide all results when no search is made. Only display results when something is typed
        searchFunction: function(helper) {
          helper.search();

          if (helper.getQuery().query === '') {
            searchHits.style.display = 'none';
            staticContent.style.display = 'block';
            return;
          }

          searchHits.style.display = 'block';
          staticContent.style.display = 'none';
        }
      });

      search.addWidget(
        instantsearch.widgets.searchBox({
          container: '#search-searchbar',
          placeholder: 'Search into all posts',
          poweredBy: true
        })
      );

      // Helper function to quickly find tge highlighed version of a key
      function highlight(hit, key) {
        if (hit._highlightResult[key]) {
          return hit._highlightResult[key].value;
        }
        return hit.key;
      }
      search.addWidget(
        instantsearch.widgets.hits({
          container: '#search-hits',
          templates: {
            item: function(hit) {
              var url = `{{ site.baseurl }}${hit.url}#${hit.anchor}`;

              var title = highlight(hit, 'title');

              var date = new Date(hit.date * 1000);
              var month = date.toLocaleString('en-us', { month: 'long' });
              var day = ("0" + date.getDate()).slice(-2);
              var year = date.getFullYear();
              var readableDate = `${month} ${day}, ${year}`;

              var headings = hit.headings.join(' > ');
              if (hit._highlightResult.headings) {
                headings = hit._highlightResult.headings
                  .map(heading => heading.value)
                  .join(' > ');
              }

              var content = hit._snippetResult.content.value;

              return `
                  <div class="search-hit">
                    <a class="search-hit-title" href="${url}">${title}</a>
                    <div class="search-hit-date">${readableDate}</div>
                    <div class="search-hit-content">
                      <div class="search-hit-headings">${headings}</div>
                      ${content}
                    </div>
                  </div>
                  `;
              }
            }
          })
      );
      search.start();
    </script>
    <!-- SEARCH END -->
  </body>
</html>
<!-- Proudly Powered by GitHub Pages | Generated {{ site.time }} | Revision {{ site.github.build_revision }} -->
