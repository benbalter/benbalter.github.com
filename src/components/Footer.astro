---
/**
 * Footer Component
 * 
 * Site-wide footer with navigation links and social connections.
 * Uses Bootstrap nav utilities and extends with minimal custom styles.
 * Matches the structure and styling of the Jekyll footer.
 */

import { footerLinks, contactLinks } from '../config';
import { escapeHtml, wrapEmailOff } from '../utils/html-escape';

// Helper to check if a URL is a mailto link
const isEmailLink = (url: string) => url.startsWith('mailto:');

/**
 * Generates HTML for an email link wrapped in Cloudflare's email_off comments
 * to prevent Cloudflare's email obfuscation from replacing the email address.
 */
function emailLinkHtml(url: string, icon: string, name: string): string {
  const safeUrl = escapeHtml(url);
  const safeIcon = escapeHtml(icon);
  const safeName = escapeHtml(name);
  
  const linkHtml = `<a href="${safeUrl}" aria-label="${safeName}" ` +
    `class="nav-link social-link" target="_blank" rel="noopener noreferrer me">` +
    `<i class="${safeIcon}" title="${safeName}"></i></a>`;
  
  return wrapEmailOff(linkHtml);
}
---

<footer class="mt-5 pt-4 border-top border-2">
  <nav aria-label="Footer navigation" class="footer-nav">
    <div class="d-flex justify-content-between px-2 py-3 mb-4 flex-wrap">
      <ul class="nav contact-links">
        {contactLinks.map((link) => (
          <li class="nav-item">
            {isEmailLink(link.url) ? (
              <Fragment set:html={emailLinkHtml(link.url, link.icon, link.name)} />
            ) : (
              <a 
                href={link.url} 
                aria-label={link.name}
                class="nav-link social-link"
                target="_blank"
                rel="noopener noreferrer me"
              >
                <i class={link.icon} title={link.name}></i>
              </a>
            )}
          </li>
        ))}
      </ul>
      
      <ul class="nav footer-links">
        {footerLinks.map((link) => (
          <li class="nav-item">
            <a href={link.url} class="nav-link link-secondary">
              {link.title}
            </a>
          </li>
        ))}
        
        <li class="nav-item">
          <a href="/feed.xml" aria-label="RSS Feed" class="nav-link">
            <i class="fas fa-rss" title="RSS Feed"></i>
          </a>
        </li>
      </ul>
    </div>
  </nav>
</footer>

<style lang="scss">
  /* Import Bootstrap nav component (scoped to this component) */
  @import 'bootstrap/scss/functions';
  @import 'bootstrap/scss/variables';
  @import 'bootstrap/scss/variables-dark';
  @import 'bootstrap/scss/maps';
  @import 'bootstrap/scss/mixins';
  @import 'bootstrap/scss/nav';

  /* Reduce footer link sizes */
  .nav-link {
    font-size: 0.875rem;
  }

  /* Ensure consistent styling for all contact links, including those rendered via set:html */
  .contact-links :global(.nav-link) {
    display: block;
    font-size: 0.875rem;
  }

  /* Responsive layout adjustments */
  @media (max-width: 768px) {
    .footer-nav > div {
      justify-content: center !important;
      flex-direction: column;
      text-align: center;
    }
    
    .contact-links,
    .footer-links {
      justify-content: center !important;
    }
  }
</style>

<!-- Note: FontAwesome icons require the FontAwesome library to be loaded in the layout -->
