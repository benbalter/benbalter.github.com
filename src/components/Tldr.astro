---
/**
 * TL;DR Component
 * 
 * Displays a "Too Long; Didn't Read" summary with tooltip explanation.
 * Matches the Jekyll tldr.html include functionality.
 */

interface Props {
  description: string;
}

const { description } = Astro.props;

const tooltipTitle = '"Too Long; Didn\'t Read" â€” Internet shorthand for "a brief summary of longer writing"';
---

<div class="lead">
  <strong><abbr title={tooltipTitle} class="initialism" data-tooltip="true" data-tooltip-text={tooltipTitle}>TL;DR</abbr>:</strong>{' '}
  {description}
</div>

<script>
  // Lightweight custom tooltip implementation (no Bootstrap dependency)
  document.addEventListener('DOMContentLoaded', () => {
    const tooltipElements = document.querySelectorAll('[data-tooltip="true"]:not([data-tooltip-initialized])');
    
    tooltipElements.forEach((element) => {
      // Mark as initialized
      element.setAttribute('data-tooltip-initialized', 'true');
      
      let tooltipEl: HTMLDivElement | null = null;
      
      // Show tooltip on mouseenter
      element.addEventListener('mouseenter', (e) => {
        const target = e.currentTarget as HTMLElement;
        const tooltipText = target.getAttribute('data-tooltip-text');
        
        if (!tooltipText) return;
        
        // Create tooltip element
        tooltipEl = document.createElement('div');
        tooltipEl.className = 'custom-tooltip';
        tooltipEl.textContent = tooltipText;
        document.body.appendChild(tooltipEl);
        
        // Position tooltip to the right of the element
        const rect = target.getBoundingClientRect();
        tooltipEl.style.left = `${rect.right + 10}px`;
        tooltipEl.style.top = `${rect.top + (rect.height / 2) - (tooltipEl.offsetHeight / 2)}px`;
        
        // Fade in
        setTimeout(() => {
          if (tooltipEl) tooltipEl.classList.add('show');
        }, 10);
      });
      
      // Hide tooltip on mouseleave
      element.addEventListener('mouseleave', () => {
        if (tooltipEl) {
          tooltipEl.classList.remove('show');
          setTimeout(() => {
            if (tooltipEl) {
              document.body.removeChild(tooltipEl);
              tooltipEl = null;
            }
          }, 200);
        }
      });
    });
  });
</script>

<style>
  .lead {
    font-size: 1.25rem;
    font-weight: 300;
  }

  .initialism {
    text-decoration: none;
    cursor: help;
    border-bottom: 1px dotted currentColor;
  }

  abbr[data-tooltip="true"] {
    text-decoration: none;
  }

  /* Custom tooltip styles */
  :global(.custom-tooltip) {
    position: fixed;
    background-color: #000;
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.875rem;
    line-height: 1.4;
    max-width: 300px;
    z-index: 1050;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    pointer-events: none;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  }

  :global(.custom-tooltip.show) {
    opacity: 0.9;
  }

  :global(.custom-tooltip::before) {
    content: '';
    position: absolute;
    right: 100%;
    top: 50%;
    transform: translateY(-50%);
    border: 5px solid transparent;
    border-right-color: #000;
  }
</style>
