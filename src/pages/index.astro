---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { siteConfig } from '../config';
import { getPostUrl, getDateFromSlug, formatPostDate } from '../utils/post-urls';

const title = 'Posts';
const description = siteConfig.description;

// Get all published posts (excluding archived), sorted by date (newest first)
const allPosts = await getCollection('posts', ({ data }: CollectionEntry<'posts'>) => {
  return data.published !== false && data.archived !== true;
});

// Sort posts by slug (which contains date in Jekyll format YYYY-MM-DD)
const posts: CollectionEntry<'posts'>[] = allPosts.sort((a: CollectionEntry<'posts'>, b: CollectionEntry<'posts'>) => 
  b.slug.localeCompare(a.slug)
);
---

<BaseLayout title={title} description={description} hero={true}>
  <div class="container-fluid px-3">
    {posts.map((post) => {
      const postDate = getDateFromSlug(post.slug);
      const postUrl = getPostUrl(post.slug);
      return (
        <div class="row mb-2">
          <div class="col-md-9">
            <a href={postUrl}>{post.data.title}</a>
          </div>
          <div class="col-md-3 text-muted text-md-end">
            <small>{formatPostDate(postDate)}</small>
          </div>
        </div>
      );
    })}
  </div>
</BaseLayout>

<style>
  .row {
    display: flex;
    flex-wrap: wrap;
    margin-right: 0;
    margin-left: 0;
  }

  .col-md-9 {
    flex: 0 0 auto;
    width: 75%;
    padding: 0;
    padding-right: 0.5rem; /* Add spacing between title and date */
  }

  .col-md-3 {
    flex: 0 0 auto;
    width: 25%;
    padding: 0;
  }

  .text-muted {
    color: var(--bs-secondary-color, #6c757d) !important;
  }

  .text-md-end {
    text-align: right;
  }

  .mb-2 {
    margin-bottom: 0.5rem !important;
  }

  @media (max-width: 768px) {
    .col-md-9,
    .col-md-3 {
      width: 100%;
    }
    
    .text-md-end {
      text-align: left;
    }
  }
</style>
