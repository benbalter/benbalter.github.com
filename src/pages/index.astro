---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import { siteConfig } from '../config';
import { getPostUrl, getDateFromSlug, formatPostDate } from '../utils/post-urls';

const title = 'Posts';
const description = siteConfig.description;

// Get all published posts (excluding archived), sorted by date (newest first)
const allPosts = await getCollection('posts', ({ data }: CollectionEntry<'posts'>) => {
  return data.published !== false && data.archived !== true;
});

// Sort posts by slug (which contains date in Jekyll format YYYY-MM-DD)
const posts: CollectionEntry<'posts'>[] = allPosts.sort((a: CollectionEntry<'posts'>, b: CollectionEntry<'posts'>) => 
  b.slug.localeCompare(a.slug)
);
---

<BaseLayout title={title} description={description} hero={true}>
  <h1 class="visually-hidden">Posts</h1>
  <ul class="list-unstyled p-0 m-0">
    {posts.map((post) => {
      const postDate = getDateFromSlug(post.slug);
      const postUrl = getPostUrl(post.slug);
      return (
        <li class="post-item py-2 border-bottom">
          <div class="row g-0">
            <div class="col-md-9">
              <div class="mb-1">
                <a href={postUrl} class="text-body text-decoration-none">{post.data.title}</a>
              </div>
            </div>
            <div class="col-md-3 text-md-end">
              <small class="text-body-secondary">{formatPostDate(postDate)}</small>
            </div>
          </div>
        </li>
      );
    })}
  </ul>
</BaseLayout>
