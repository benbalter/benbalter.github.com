// Optimized stylesheet for Astro build
// This imports only necessary Bootstrap components to reduce bundle size

// 1. Include functions first (required for everything)
@import 'bootstrap/scss/functions';

// 2. Custom Bootstrap variables (must be defined before importing other Bootstrap)
$header-path: "/assets/img/header.jpg";
$blue: #337ab7;
$enable-shadows: true;
$enable-gradients: true;
$tooltip-max-width: 350px;
$color-mode-type: media-query;

// 3. Include variable defaults
@import 'bootstrap/scss/variables';
@import 'bootstrap/scss/variables-dark';

// 4. Include maps (required for utilities)
@import 'bootstrap/scss/maps';

// 5. Include mixins
@import 'bootstrap/scss/mixins';

// 6. Layout & components - Only import what we actually use
@import 'bootstrap/scss/root';
@import 'bootstrap/scss/reboot';
@import 'bootstrap/scss/type';
@import 'bootstrap/scss/images';
@import 'bootstrap/scss/containers';
@import 'bootstrap/scss/grid';

// Navigation components (needed for navbar)
@import 'bootstrap/scss/nav';
@import 'bootstrap/scss/navbar';

// Button (needed for navbar toggle on mobile)
@import 'bootstrap/scss/buttons';

// Skip unused components to reduce bundle size:
// - forms (no forms on static blog)
// - accordion, alert, badge, breadcrumb, button-group, card, carousel, 
//   close, dropdown, list-group, modal, offcanvas, pagination, 
//   placeholders, popover, progress, spinners, toasts, tooltip

// Include only what we need:
@import 'bootstrap/scss/tables';     // For markdown tables
@import 'bootstrap/scss/transitions'; // For smooth interactions

// 7. Helpers
@import 'bootstrap/scss/helpers';

// Add minimal utility classes we actually use in pages
.justify-content-center {
    justify-content: center !important;
}

.align-items-center {
    align-items: center !important;
}

.text-center {
    text-align: center !important;
}

.text-start {
    text-align: left !important;
}

.text-end {
    text-align: right !important;
}

.mb-3 {
    margin-bottom: 1rem !important;
}

.mt-2 {
    margin-top: 0.5rem !important;
}

// Text alignment utilities for responsive sizes
@media (min-width: 576px) {
    .text-sm-center {
        text-align: center !important;
    }
    .text-sm-start {
        text-align: left !important;
    }
}

// Skip the full utilities API to reduce bundle size significantly
// Component-specific styles will handle their own utility needs

// Accessibility: Skip to content link
.skip-to-content {
    position: absolute;
    left: -10000px;
    top: auto;
    width: 1px;
    height: 1px;
    overflow: hidden;
    
    &:focus {
        position: fixed;
        left: 0;
        top: 0;
        width: auto;
        height: auto;
        background: #0366d6;
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        z-index: 9999;
        border-radius: 0 0 4px 0;
        outline: 2px solid #fff;
        outline-offset: 2px;
    }
}

// Typography improvements
// Use a modern system font stack for optimal performance and native look
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    // Fluid typography - scales between 16px and 18px based on viewport
    font-size: clamp(1rem, 0.9rem + 0.5vw, 1.125rem);
    line-height: 1.6; // Optimal for body text
    font-weight: 400;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1; // Enable kerning, ligatures, and contextual alternates
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    // Preserve Bootstrap's color mode variables for dark mode support
    color: var(--bs-body-color);
    background-color: var(--bs-body-bg);
}

// Modular scale for harmonious typography
// Using 1.25 (major third) scale for better hierarchy
h1, h2, h3, h4, h5, h6 {
    font-weight: 700; // Stronger weight for better hierarchy
    line-height: 1.25; // Tighter for headings
    margin-top: 1.75em;
    margin-bottom: 0.5em;
    letter-spacing: -0.02em; // Slight negative tracking for large text
    font-feature-settings: "kern" 1, "liga" 1;
}

// Fluid heading sizes for better responsive typography
h1 { 
    font-size: clamp(1.875rem, 1.5rem + 1.875vw, 2.441rem); // 30px to 39px
    margin-top: 0;
}

h2 { 
    font-size: clamp(1.5rem, 1.25rem + 1.25vw, 1.953rem); // 24px to 31px
}

h3 { 
    font-size: clamp(1.25rem, 1.1rem + 0.75vw, 1.563rem); // 20px to 25px
}

h4 { 
    font-size: clamp(1.125rem, 1rem + 0.625vw, 1.25rem); // 18px to 20px
}

h5, h6 { 
    font-size: 1rem;
}

// Optimize paragraph typography
p {
    margin-bottom: 1.5rem;
    orphans: 3;
    widows: 3;
}

// Scope optimal line length to main content areas
article p,
.content p,
main p {
    max-width: 70ch; // Optimal line length for readability
}

// Improve paragraph after headings
h1 + p, h2 + p, h3 + p, h4 + p, h5 + p, h6 + p {
    margin-top: 0.5em;
}

// Improve list styling
ul, ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
}

// Scope optimal line length to main content areas for lists
article ul,
article ol,
.content ul,
.content ol,
main ul,
main ol {
    max-width: 70ch;
}

li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
}

// Remove margin from last item
li:last-child {
    margin-bottom: 0;
}

// Improve code block styling
pre {
    padding: 1rem;
    background-color: var(--bs-secondary-bg);
    border-radius: var(--bs-border-radius);
    margin: 1.5rem 0;
    overflow-x: auto;
    line-height: 1.5;
}

code {
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    font-size: 0.875em; // Slightly smaller than body
    padding: 0.2em 0.4em;
    background-color: var(--bs-secondary-bg);
    border-radius: 0.25rem;
    font-feature-settings: normal; // Disable ligatures in code
}

pre code {
    padding: 0;
    background-color: transparent;
    font-size: 0.9em;
}

// Improve link styling - scoped to content areas to avoid affecting navigation
article a,
.content a,
main a:not(.btn):not(.nav-link):not(.navbar-brand) {
    color: var(--bs-link-color);
    text-decoration-line: underline;
    text-decoration-thickness: 0.0625em;
    text-decoration-skip-ink: auto;
    text-underline-offset: 0.125em;
    transition: color 0.15s ease-in-out, text-decoration-color 0.15s ease-in-out;
}

article a:hover,
.content a:hover,
main a:not(.btn):not(.nav-link):not(.navbar-brand):hover {
    color: var(--bs-link-hover-color);
    text-decoration-thickness: 0.125em;
}

article a:focus,
.content a:focus,
main a:not(.btn):not(.nav-link):not(.navbar-brand):focus {
    outline: 2px solid var(--bs-link-color);
    outline-offset: 2px;
    border-radius: 2px;
}

// Default link styling for non-content areas (navigation, etc.)
a {
    color: var(--bs-link-color);
    text-decoration: none;
    transition: color 0.15s ease-in-out;
}

a:hover {
    color: var(--bs-link-hover-color);
}

// Inline text elements
strong, b {
    font-weight: 700;
}

em, i {
    font-style: italic;
}

small {
    font-size: 0.875em;
}

// Superscript and subscript
sup, sub {
    font-size: 0.75em;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

// Table improvements
table {
    margin: 1.5rem 0;
    max-width: 100%;
}

th, td {
    padding: 0.75rem;
    line-height: 1.5;
}

// Custom styles
abbr[data-bs-original-title] {
    // Apply abbr styles directly
    text-decoration: underline;
    text-decoration-style: dotted;
    cursor: help;
    text-decoration-color: inherit;
}

.footnotes {
    font-size: 0.875rem;
    border-top: 1px solid var(--bs-border-color);
    padding-top: 1rem;
    margin-top: 3rem;
}

.footnotes::before {
    content: "Notes:";
    margin-bottom: 1rem;
    display: block;
    font-weight: 600;
}

.footnotes ol {
    padding-left: 1rem;
}

.footnotes ol li p {
    margin-bottom: 0.5rem;
}

.hero-unit {
    background-image: url($header-path);
    background-size: cover;
    background-position: top left;
    height: 400px;
}

.gist {
    .gist-it-gist .gist-file .gist-data,
    .gist-meta {
        background: #fcfcff !important;
    }

    .pl-c {
        color: #757775 !important;
    }

    .pl-c1 {
        color: #007faa !important;
    }
}

.min-y-5 {
    min-height: 5em;
}

blockquote {
    border-left: 4px solid var(--bs-gray-400);
    padding-left: 1.5rem;
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
    margin: 2rem 0;
    color: var(--bs-secondary-color);
    font-style: italic;
    font-size: 1.125rem;
    
    p {
        margin-bottom: 1rem;
    }
    
    p:last-child {
        margin-bottom: 0;
    }
}

// Scope optimal line length to main content areas for blockquotes
article blockquote,
.content blockquote,
main blockquote {
    max-width: 65ch;
}

.avatar {
    max-width: 100%;
    height: auto;
    border-radius: var(--bs-border-radius);
}

// Footer link accessibility fix
// Bootstrap's link-secondary uses gray-600 (#6c757d) which has ~4.48:1 contrast ratio
// against white, below WCAG AA requirement of 4.5:1. Using gray-700 (#495057) provides
// ~7.13:1 contrast ratio, meeting both WCAG AA and AAA requirements.
footer .link-secondary,
nav .border-top .link-secondary {
    color: var(--bs-gray-700) !important;

    &:hover,
    &:focus {
        color: var(--bs-gray-800) !important;
    }
}

// Dark mode footer link adjustment
@media (prefers-color-scheme: dark) {
    footer .link-secondary,
    nav .border-top .link-secondary {
        color: var(--bs-gray-400) !important;

        &:hover,
        &:focus {
            color: var(--bs-gray-300) !important;
        }
    }
    
    blockquote {
        border-left-color: var(--bs-gray-600);
    }
}

// Mobile typography optimizations
// Use Bootstrap's breakpoint mixin for consistency
@include media-breakpoint-down(md) {
    body {
        // Slightly smaller base font on mobile
        font-size: clamp(0.9375rem, 0.875rem + 0.3125vw, 1rem);
    }
    
    h1, h2, h3, h4, h5, h6 {
        // Reduce letter spacing on mobile
        letter-spacing: -0.01em;
    }
    
    // Remove max-width constraints on mobile for better use of space
    article p,
    .content p,
    main p,
    article ul,
    article ol,
    .content ul,
    .content ol,
    main ul,
    main ol,
    article blockquote,
    .content blockquote,
    main blockquote {
        max-width: 100%;
    }
}

// Header anchor links styling
// These styles match the behavior of anchor-js used in Jekyll/Next.js
.anchor-link {
    text-decoration: none;
    margin-left: 0.25rem;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    
    .anchor-icon {
        color: $blue;
        font-weight: normal;
    }
}

// Show anchor links on hover or focus
h1, h2, h3, h4, h5, h6 {
    position: relative;
    
    &:hover .anchor-link,
    & .anchor-link:focus {
        opacity: 1;
    }
}

// Skip to content link (accessibility best practice)
// Only visible when focused via keyboard navigation
.skip-to-content {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--bs-primary);
    color: white;
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 0 0 4px 0;
    z-index: 100;
    font-weight: 600;
    
    &:focus {
        top: 0;
        // Use white outline for better contrast against the primary background
        outline: 3px solid white;
        outline-offset: -3px;
    }
}

// Bootstrap's visually-hidden-focusable utility for skip link
.visually-hidden-focusable:not(:focus):not(:focus-within) {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

// Fix: When both .skip-to-content and .visually-hidden-focusable are present,
//      ensure .skip-to-content's visual hiding/showing takes precedence.
.skip-to-content.visually-hidden-focusable {
    position: absolute !important;
    top: -40px !important;
    left: 0 !important;
    width: auto !important;
    height: auto !important;
    padding: 8px 16px !important;
    margin: 0 !important;
    overflow: visible !important;
    clip: auto !important;
    white-space: normal !important;
    border-radius: 0 0 4px 0 !important;
    border: none !important;
    background: var(--bs-primary) !important;
    color: white !important;
    font-weight: 600 !important;
    z-index: 100 !important;
    text-decoration: none !important;
}
.skip-to-content.visually-hidden-focusable:focus {
    top: 0 !important;
    outline: 3px solid white !important;
    outline-offset: -3px !important;
}
