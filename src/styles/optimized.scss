// Optimized stylesheet for Astro build
// This imports only necessary Bootstrap components to reduce bundle size

// Font Awesome SVG Core styles (required for SVG icons to display)
@import '@fortawesome/fontawesome-svg-core/styles.css';

// 1. Include functions first (required for everything)
@import 'bootstrap/scss/functions';

// 2. Custom Bootstrap variables (must be defined before importing other Bootstrap)
$header-path: "/assets/img/header.jpg";
$blue: #337ab7;
$enable-shadows: true;
$enable-gradients: true;
$tooltip-max-width: 350px;
$color-mode-type: media-query;

// Content container padding (matches grid gutter / 2)
$content-padding-x: 15px;

// 3. Include variable defaults
@import 'bootstrap/scss/variables';
@import 'bootstrap/scss/variables-dark';

// 4. Include maps (required for utilities)
@import 'bootstrap/scss/maps';

// 5. Include mixins
@import 'bootstrap/scss/mixins';

// 6. Layout & components - Only import globally-needed components
@import 'bootstrap/scss/root';
@import 'bootstrap/scss/reboot';
@import 'bootstrap/scss/type';
@import 'bootstrap/scss/images';
@import 'bootstrap/scss/containers';
@import 'bootstrap/scss/grid';

// Tables are used in markdown content throughout the site
@import 'bootstrap/scss/tables';

// Transitions for smooth interactions (used globally)
@import 'bootstrap/scss/transitions';

// Component-specific imports moved to individual Astro components:
// - alert: Moved to ArchivedPostWarning.astro, FossAtScale.astro, GitHubCulture.astro
// - badge: Moved to PostLayout.astro
// - nav/navbar/buttons: Moved to Navigation.astro and Footer.astro

// 7. Helpers
@import 'bootstrap/scss/helpers';

// Add minimal utility classes we actually use in pages
.justify-content-center {
    justify-content: center !important;
}

.align-items-center {
    align-items: center !important;
}

.text-center {
    text-align: center !important;
}

.text-start {
    text-align: left !important;
}

.text-end {
    text-align: right !important;
}

.mb-3 {
    margin-bottom: 1rem !important;
}

.mb-2 {
    margin-bottom: 0.5rem !important;
}

.mb-4 {
    margin-bottom: 1.5rem !important;
}

.mt-2 {
    margin-top: 0.5rem !important;
}

.mt-4 {
    margin-top: 1.5rem !important;
}

.ms-3 {
    margin-left: 1rem !important;
}

.me-2 {
    margin-right: 0.5rem !important;
}

// Float utilities (used in MiniBio component)
.float-start {
    float: left !important;
}

.float-end {
    float: right !important;
}

// Padding utilities (used in MiniBio and other components)
.pt-1 {
    padding-top: 0.25rem !important;
}

.pt-3 {
    padding-top: 1rem !important;
}

.pb-3 {
    padding-bottom: 1rem !important;
}

.pe-3 {
    padding-right: 1rem !important;
}

.px-2 {
    padding-left: 0.5rem !important;
    padding-right: 0.5rem !important;
}

.py-2 {
    padding-top: 0.5rem !important;
    padding-bottom: 0.5rem !important;
}

.py-3 {
    padding-top: 1rem !important;
    padding-bottom: 1rem !important;
}

.mb-0 {
    margin-bottom: 0 !important;
}

// Border utilities
.border-top {
    border-top: var(--bs-border-width) solid var(--bs-border-color) !important;
}

// Border radius utilities
.rounded {
    border-radius: var(--bs-border-radius) !important;
}

.rounded-top {
    border-top-left-radius: var(--bs-border-radius) !important;
    border-top-right-radius: var(--bs-border-radius) !important;
}

.rounded-bottom {
    border-bottom-left-radius: var(--bs-border-radius) !important;
    border-bottom-right-radius: var(--bs-border-radius) !important;
}

// Display utilities
.d-block {
    display: block !important;
}

.d-inline-block {
    display: inline-block !important;
}

.d-flex {
    display: flex !important;
}

// Flexbox utilities
.flex-wrap {
    flex-wrap: wrap !important;
}

.justify-content-end {
    justify-content: flex-end !important;
}

.justify-content-between {
    justify-content: space-between !important;
}

// Position utilities
.clearfix::after {
    display: block;
    clear: both;
    content: "";
}

// Background color utilities
.bg-secondary {
    background-color: var(--bs-secondary) !important;
}

// Typography utilities
.small {
    font-size: 0.875em;
}

.text-muted {
    color: var(--bs-secondary-color) !important;
}

.text-primary {
    color: var(--bs-primary) !important;
}

.lead {
    font-size: 1.25rem;
    font-weight: 300;
}

.display-4 {
    font-size: calc(1.475rem + 2.7vw);
    font-weight: 300;
    line-height: 1.2;
}

@media (min-width: 1200px) {
    .display-4 {
        font-size: 3.5rem;
    }
}

// Link utilities
.link-secondary {
    color: var(--bs-secondary-color);
    text-decoration-color: var(--bs-secondary-color);
}

.link-secondary:hover,
.link-secondary:focus {
    color: var(--bs-secondary-color);
    text-decoration-color: var(--bs-secondary-color);
}

// Text alignment utilities for responsive sizes
@media (min-width: 576px) {
    .text-sm-center {
        text-align: center !important;
    }
    .text-sm-start {
        text-align: left !important;
    }
}

// Skip the full utilities API to reduce bundle size significantly
// Component-specific styles will handle their own utility needs

// Accessibility: Skip to content link
.skip-to-content {
    position: absolute;
    left: -10000px;
    top: auto;
    width: 1px;
    height: 1px;
    overflow: hidden;
    
    &:focus {
        position: fixed;
        left: 0;
        top: 0;
        width: auto;
        height: auto;
        background: #0366d6;
        color: white;
        padding: 8px 16px;
        text-decoration: none;
        z-index: 9999;
        border-radius: 0 0 4px 0;
        outline: 2px solid #fff;
        outline-offset: 2px;
    }
}

// Typography improvements
// Use a modern system font stack for optimal performance and native look
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    // Enhanced fluid typography - scales between 16px and 19px based on viewport for better readability
    font-size: clamp(1rem, 0.9rem + 0.5vw, 1.1875rem);
    line-height: 1.7; // Increased from 1.6 for better readability
    font-weight: 400;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1; // Enable kerning, ligatures, and contextual alternates
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    // Preserve Bootstrap's color mode variables for dark mode support
    color: var(--bs-body-color);
    background-color: var(--bs-body-bg);
}

// Modular scale for harmonious typography
// Using 1.25 (major third) scale for better hierarchy
h1, h2, h3, h4, h5, h6 {
    font-weight: 700; // Stronger weight for better hierarchy
    line-height: 1.3; // Slightly increased from 1.25 for better readability
    margin-top: 2em; // Space above for clear section separation
    margin-bottom: 0.5em; // Tighter coupling with following content (best practice: less below, more above)
    letter-spacing: -0.015em; // Reduced from -0.02em for slightly looser tracking
    font-feature-settings: "kern" 1, "liga" 1;
    color: var(--bs-emphasis-color); // Better contrast for headings
}

// Fluid heading sizes for better responsive typography
h1 { 
    font-size: clamp(1.875rem, 1.5rem + 1.875vw, 2.441rem); // 30px to 39px
    margin-top: 0;
}

h2 { 
    font-size: clamp(1.5rem, 1.25rem + 1.25vw, 1.953rem); // 24px to 31px
}

h3 { 
    font-size: clamp(1.25rem, 1.1rem + 0.75vw, 1.563rem); // 20px to 25px
}

h4 { 
    font-size: clamp(1.125rem, 1rem + 0.625vw, 1.25rem); // 18px to 20px
}

h5, h6 { 
    font-size: 1rem;
}

// Optimize paragraph typography
p {
    margin-bottom: 1.75rem; // Increased from 1.5rem for better paragraph separation
    orphans: 3;
    widows: 3;
    // Add subtle hyphenation for long words on narrow screens
    hyphens: auto;
}

// Note: Line length is controlled by layout containers (e.g., col-md-10 offset-md-1)
// rather than max-width constraints, to allow content to fill the container properly

// Improve paragraph after headings
h1 + p, h2 + p, h3 + p, h4 + p, h5 + p, h6 + p {
    margin-top: 0; // Changed from 0.5em to 0 for tighter spacing between headings and paragraphs
}

// Improve list styling
ul, ol {
    margin-top: 0; // Tighter coupling when list immediately follows heading or paragraph
    margin-bottom: 1.5rem; // Slightly reduced for better rhythm (was 1.75rem)
    padding-left: 2rem; // Good visual alignment with text
}

// Note: List width is controlled by layout containers
// rather than max-width constraints

li {
    margin-bottom: 0.5rem; // Slightly tighter list item spacing for better visual grouping
    line-height: 1.7; // Match body text line-height
    padding-left: 0.25rem; // Add slight indent for better text alignment
}

li > ul, li > ol {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
}

// Remove margin from last item
li:last-child {
    margin-bottom: 0;
}

// Ensure proper spacing when headings follow lists or other block elements
// This creates clear visual section breaks in the content
ul + h2, ul + h3, ul + h4, ul + h5, ul + h6,
ol + h2, ol + h3, ol + h4, ol + h5, ol + h6,
blockquote + h2, blockquote + h3, blockquote + h4, blockquote + h5, blockquote + h6,
pre + h2, pre + h3, pre + h4, pre + h5, pre + h6 {
    margin-top: 2.5em; // Extra space after content blocks before new sections
}

// Ensure the same spacing applies within post/page content where headings
// are restyled with higher-specificity selectors (e.g., .post-content :global(h2))
.post-content :global(blockquote) + :global(h2),
.post-content :global(blockquote) + :global(h3),
.post-content :global(blockquote) + :global(h4),
.post-content :global(blockquote) + :global(h5),
.post-content :global(blockquote) + :global(h6),
.post-content :global(pre) + :global(h2),
.post-content :global(pre) + :global(h3),
.post-content :global(pre) + :global(h4),
.post-content :global(pre) + :global(h5),
.post-content :global(pre) + :global(h6),
.page-body :global(blockquote) + :global(h2),
.page-body :global(blockquote) + :global(h3),
.page-body :global(blockquote) + :global(h4),
.page-body :global(blockquote) + :global(h5),
.page-body :global(blockquote) + :global(h6),
.page-body :global(pre) + :global(h2),
.page-body :global(pre) + :global(h3),
.page-body :global(pre) + :global(h4),
.page-body :global(pre) + :global(h5),
.page-body :global(pre) + :global(h6) {
    margin-top: 2.5em; // Match global spacing after blockquotes/code blocks
}

// Improve code block styling
pre {
    padding: 1.25rem; // Increased from 1rem for better breathing room
    background-color: var(--bs-secondary-bg);
    border-radius: var(--bs-border-radius);
    margin: 2rem 0; // Increased from 1.5rem for better separation
    overflow-x: auto;
    line-height: 1.6; // Increased from 1.5 for better code readability
    border: 1px solid var(--bs-border-color); // Add subtle border
}

code {
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    font-size: 0.9em; // Increased from 0.875em for better readability
    padding: 0.2em 0.5em; // Increased horizontal padding from 0.4em to 0.5em
    background-color: var(--bs-secondary-bg);
    border-radius: 0.3rem; // Increased from 0.25rem for softer appearance
    font-feature-settings: normal; // Disable ligatures in code
    border: 1px solid var(--bs-border-color); // Add subtle border to inline code
}

pre code {
    padding: 0;
    background-color: transparent;
    font-size: 0.95em; // Increased from 0.9em
    border: none; // Remove border for code inside pre
}

// Improve link styling - scoped to content areas to avoid affecting navigation
article a:not(.anchor-link),
.content a:not(.anchor-link),
main a:not(.btn):not(.nav-link):not(.navbar-brand):not(.anchor-link) {
    color: var(--bs-link-color);
    text-decoration-line: underline;
    text-decoration-thickness: 0.08em; // Increased from 0.0625em for better visibility
    text-decoration-skip-ink: auto;
    text-underline-offset: 0.15em; // Increased from 0.125em for better separation
    transition: color 0.2s ease-in-out, text-decoration-color 0.2s ease-in-out;
}

article a:not(.anchor-link):hover,
.content a:not(.anchor-link):hover,
main a:not(.btn):not(.nav-link):not(.navbar-brand):not(.anchor-link):hover {
    color: var(--bs-link-hover-color);
    text-decoration-thickness: 0.15em; // Increased from 0.125em for more prominent hover effect
}

article a:not(.anchor-link):focus,
.content a:not(.anchor-link):focus,
main a:not(.btn):not(.nav-link):not(.navbar-brand):not(.anchor-link):focus {
    outline: 2px solid var(--bs-link-color);
    outline-offset: 3px; // Increased from 2px for better visibility
    border-radius: 3px; // Increased from 2px
}

// Default link styling for non-content areas (navigation, etc.)
a {
    color: var(--bs-link-color);
    text-decoration: none;
    transition: color 0.15s ease-in-out;
}

a:hover {
    color: var(--bs-link-hover-color);
}

// Inline text elements
strong, b {
    font-weight: 700;
}

em, i {
    font-style: italic;
}

small {
    font-size: 0.875em;
}

// Superscript and subscript
sup, sub {
    font-size: 0.75em;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

// Table improvements
table {
    margin: 1.5rem 0;
    max-width: 100%;
}

th, td {
    padding: 0.75rem;
    line-height: 1.5;
}

// Custom styles
abbr[data-bs-original-title] {
    // Apply abbr styles directly
    text-decoration: underline;
    text-decoration-style: dotted;
    cursor: help;
    text-decoration-color: inherit;
}

.footnotes {
    font-size: 0.875rem;
    border-top: 1px solid var(--bs-border-color);
    padding-top: 1rem;
    margin-top: 3rem;
}

.footnotes h2 {
    margin-bottom: 0.5rem;
}

.footnotes ol {
    padding-left: 1rem;
    margin-bottom: 0;
}

.footnotes ol li {
    margin-bottom: 0.5rem;
}

.footnotes ol li p {
    margin-bottom: 0;
}

.hero-unit {
    background-image: url($header-path);
    background-size: cover;
    background-position: top left;
    height: 400px;
    border-radius: var(--bs-border-radius-lg);
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
}

.gist {
    .gist-it-gist .gist-file .gist-data,
    .gist-meta {
        background: #fcfcff !important;
    }

    .pl-c {
        color: #6f716f !important; // WCAG AA compliant: 4.81:1 contrast ratio
    }

    .pl-c1 {
        color: #0078a1 !important; // WCAG AA compliant: 4.88:1 contrast ratio
    }
}

.min-y-5 {
    min-height: 5em;
}

blockquote {
    border-left: 5px solid var(--bs-primary); // Increased from 4px and use primary color for emphasis
    padding-left: 2rem; // Increased from 1.5rem for better visual separation
    padding-top: 0.75rem; // Increased from 0.5rem
    padding-bottom: 0.75rem; // Increased from 0.5rem
    margin: 2.5rem 0; // Increased from 2rem for more prominence
    color: var(--bs-body-color); // Changed from secondary-color for better readability
    font-style: italic;
    font-size: 1.125rem;
    line-height: 1.75; // Added explicit line-height for blockquotes
    background-color: var(--bs-secondary-bg); // Add subtle background
    border-radius: 0.25rem; // Add subtle rounding
    
    p {
        margin-bottom: 1rem;
    }
    
    p:last-child {
        margin-bottom: 0;
    }
}

// Note: Blockquote width is controlled by layout containers
// rather than max-width constraints

.avatar {
    max-width: 100%;
    height: auto;
    border-radius: var(--bs-border-radius);
}

// Footer link accessibility fix
// Bootstrap's link-secondary uses gray-600 (#6c757d) which has ~4.48:1 contrast ratio
// against white, below WCAG AA requirement of 4.5:1. Using gray-700 (#495057) provides
// ~7.13:1 contrast ratio, meeting both WCAG AA and AAA requirements.
footer .link-secondary,
nav .border-top .link-secondary {
    color: var(--bs-gray-700) !important;

    &:hover,
    &:focus {
        color: var(--bs-gray-800) !important;
    }
}

// Dark mode footer link adjustment
@media (prefers-color-scheme: dark) {
    footer .link-secondary,
    nav .border-top .link-secondary {
        color: var(--bs-gray-400) !important;

        &:hover,
        &:focus {
            color: var(--bs-gray-300) !important;
        }
    }
    
    blockquote {
        border-left-color: var(--bs-primary); // Use primary color in dark mode too for consistency
        background-color: rgba(var(--bs-primary-rgb), 0.05); // Subtle background tint
    }
}

// Mobile typography optimizations
// Use Bootstrap's breakpoint mixin for consistency
@include media-breakpoint-down(md) {
    body {
        // Optimized base font on mobile - slightly larger minimum for better readability
        font-size: clamp(1rem, 0.925rem + 0.375vw, 1.0625rem);
        line-height: 1.65; // Slightly reduced from 1.7 for mobile
    }
    
    h1, h2, h3, h4, h5, h6 {
        // Reduce letter spacing on mobile
        letter-spacing: -0.01em;
        margin-top: 1.5em; // Reduced from 2em for mobile
        margin-bottom: 0.5em; // Reduced from 0.75em for mobile
    }
    
    p {
        margin-bottom: 1.5rem; // Slightly reduced from 1.75rem for mobile
    }
    
    ul, ol {
        margin-bottom: 1.25rem; // Slightly reduced from desktop for mobile
        padding-left: 1.5rem; // Slightly reduced from 2rem for mobile
    }
    
    blockquote {
        margin: 2rem 0; // Reduced from 2.5rem for mobile
        padding-left: 1.5rem; // Reduced from 2rem for mobile
        font-size: 1.0625rem; // Slightly smaller on mobile
    }
    
    // Note: Max-width constraints removed globally, not needed on mobile either
}

// Header anchor links styling
// These styles match the behavior of anchor-js used in Jekyll
.anchor-link {
    text-decoration: none;
    margin-left: 0.25rem;
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    
    .anchor-icon {
        color: $blue;
        font-weight: normal;
    }
}

// Show anchor links on hover or focus
h1, h2, h3, h4, h5, h6 {
    position: relative;
    
    &:hover .anchor-link,
    & .anchor-link:focus {
        opacity: 1;
    }
}

// Skip to content link (accessibility best practice)
// Only visible when focused via keyboard navigation
.skip-to-content {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--bs-primary);
    color: white;
    padding: 8px 16px;
    text-decoration: none;
    border-radius: 0 0 4px 0;
    z-index: 100;
    font-weight: 600;
    
    &:focus {
        top: 0;
        // Use white outline for better contrast against the primary background
        outline: 3px solid white;
        outline-offset: -3px;
    }
}

// Bootstrap's visually-hidden-focusable utility for skip link
.visually-hidden-focusable:not(:focus):not(:focus-within) {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

// Fix: When both .skip-to-content and .visually-hidden-focusable are present,
//      ensure .skip-to-content's visual hiding/showing takes precedence.
.skip-to-content.visually-hidden-focusable {
    position: absolute !important;
    top: -40px !important;
    left: 0 !important;
    width: auto !important;
    height: auto !important;
    padding: 8px 16px !important;
    margin: 0 !important;
    overflow: visible !important;
    clip: auto !important;
    white-space: normal !important;
    border-radius: 0 0 4px 0 !important;
    border: none !important;
    background: var(--bs-primary) !important;
    color: white !important;
    font-weight: 600 !important;
    z-index: 100 !important;
    text-decoration: none !important;
}
.skip-to-content.visually-hidden-focusable:focus {
    top: 0 !important;
    outline: 3px solid white !important;
    outline-offset: -3px !important;
}

// Enhanced post list styling - only truly custom styles that can't be Bootstrap utilities
.post-item {
    transition: all 0.2s ease-in-out;
    
    // Only apply hover effect on devices that support hover
    @media (hover: hover) {
        &:hover {
            padding-left: 0.5rem;
            border-left: 3px solid $blue;
        }
    }
    
    a {
        transition: color 0.15s ease-in-out;
        
        &:hover {
            color: $blue;
        }
    }
}

// Enhanced navigation styling - only truly custom animations
.navbar {
    .navbar-brand {
        transition: color 0.15s ease-in-out;
        
        &:hover {
            color: $blue !important;
        }
    }
    
    .nav-link {
        position: relative;
        
        &::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 1rem;
            right: 1rem;
            height: 2px;
            background: $blue;
            transform: scaleX(0);
            transition: transform 0.2s ease-in-out;
        }
        
        &:hover::after,
        &.active::after {
            transform: scaleX(1);
        }
        
        &.active {
            color: $blue !important;
        }
    }
}

// Enhanced footer - only custom hover animations
footer {
    .social-link {
        transition: all 0.2s ease-in-out;
        
        &:hover {
            transform: translateY(-2px);
            color: $blue;
        }
    }
}

// Button enhancements - only custom hover animations
.btn {
    transition: all 0.2s ease-in-out;
    
    &:hover {
        transform: scale(1.02);
        box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.15);
    }
}
